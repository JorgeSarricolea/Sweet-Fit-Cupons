---
import Layout from "@/components/Layout.astro"
import Header from "@/components/Header.astro"
import ViewCupons from "@/components/table/ViewCupons.astro"

export async function getCupons(){
    try{
        const response = await fetch('http://localhost:3000/api/cupons')
        if(!response.ok){
            throw new Error('Failed to get cupons')
        }
        return await response.json()
    }
    catch(error){
        console.error(error);
        return []
    }
}
export async function getUsers(){
    try{
        const response = await fetch('http://localhost:3000/api/users')
        if(!response.ok){
            throw new Error('Failed to get cupons')
        }
        return await response.json()
    }
    catch(error){
        console.error(error);
        return []
    }
}
export async function getUsersCupons(){
    try{
        const response = await fetch('http://localhost:3000/api/users-cupons')
        if(!response.ok){
            throw new Error('Failed to get cupons')
        }
        return await response.json()
    }
    catch(error){
        console.error(error);
        return []
    }
}

const cuponsPerClient= await getCupons();
---



<Layout title={"User-Cupons"} description={"Cupones-Usuarios"}>
    <Header/>
    <div class="flex flex-col h-screen justify-center items-center border  p-16">

            <div class="flex flex-row justify-between w-full px-16 py-1">
            <h2 class="text-4xl font-bold text-primary mb-8 ">Cup贸nes</h2>
            <form action="" class="flex gap-4 justify-end h-10 w-1/3"> 
                <input type="text" placeholder="Buscar correo o c贸digo"  class="pl-4 w-2/3 border border-primary rounded-md p-1">
                <input type="submit" value="Buscar" class="bg-primary text-white p-1 rounded-md w-1/5">
            </form>
        </div>
        <div class="h-full w-full overflow-y-auto rounded-lg shadow-2xl p-5">
            <table class="w-full border border-red-500">
                <thead>
                    <tr>
                        <th class="text-primary font-bold text-xl text-left pl-2">Email</th>
                        <th class="text-primary font-bold text-xl text-center">C贸digo</th>
                        <th class="text-primary font-bold text-xl text-center">Expiracion</th>
                        <th class="text-primary font-bold text-xl text-center">Aplicado</th>
                        <th class="text-primary font-bold text-xl text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody class="text-center">
                    <tr>
                        <td class="text-left p-4">email123@gmail.com</td>
                        <td>Jamon1234</td>
                        <td>19/05/2024</td>
                        <td>19/04/2024</td>
                        <td><button class="bg-primary rounded-md p-1">Validar cup贸n</button></td>
                        <td><i class="fa-solid fa-trash-can text-primary"></i></td>
                        <td><i class="fa-solid fa-pen text-primary"></i></td>
                    </tr>
                    {cuponsPerClient.map((cupon)=>(
                        <ViewCupons 
                        email={[cupon.email]} 
                        code={[cupon.code]} 
                        expirationDate={[cupon.expirationDate]}
                        aplicated={[cupon.aplicated]}
                        actions={[cupon.actions]}/>
                    ))}               
                </tbody>
            </table>
        </div>
    </div>
</Layout>
